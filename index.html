<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="AplicaciÃ³n web educativa construida con Node.js que demuestra backend, frontend y comunicaciÃ³n en tiempo real con JavaScript">
  <meta name="keywords" content="Node.js, JavaScript, backend, servidor, WebSockets, Socket.IO, programaciÃ³n web, tiempo real">
  <meta name="author" content="Clase de ProgramaciÃ³n">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  <meta name="theme-color" content="#1e1e1e">
  <link rel="canonical" href="https://tuti-node.netlify.app/">
  <link rel="icon" href="https://i.imgur.com/F9CqhP3.jpeg">
  <meta property="og:title" content="Clase completa de Node.js">
  <meta property="og:description" content="AplicaciÃ³n web educativa servida con Node.js que demuestra comunicaciÃ³n en tiempo real y arquitectura web moderna">
  <meta property="og:image" content="https://i.imgur.com/F9CqhP3.jpeg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Clase prÃ¡ctica de Node.js con JavaScript y comunicaciÃ³n en tiempo real">
  <meta property="og:url" content="https://tuti-node.netlify.app/">
  <meta property="og:type" content="website">
  <title>Clase completa de Node.js</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.1.0/css/all.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.54.0-dev-20250930/min/vs/editor/editor.main.css"/>
<style>
:root { --toolbar-h: 42px; --tabs-h: 35px; }
* { box-sizing: border-box; }
html, body, #root { margin: 0; height: 100%; }
body { background: #111; font-family: system-ui, sans-serif; }
h1 { margin: 0; font-size: 16px; color: #fff; font-weight: 600; }

#app { display: flex; flex-direction: column; height: 100%; }
#toolbar { height: var(--toolbar-h); display: flex; align-items: center; padding: 0 10px; background: #1e1e1e; border-bottom: 1px solid #333; }
.toolbar-actions { margin-left: auto; display: flex; gap: 2px; }
#toolbar button { background: #007acc; border: none; color: #fff; padding: 6px 8px; border-radius: 4px; cursor: pointer; font-size: 13px; display: inline-flex; align-items: center; gap: 4px; }
#toolbar button:hover { background: #005a99; }

#tabs { height: var(--tabs-h); background: #252526; display: flex; align-items: flex-end; padding: 0 8px; border-bottom: 1px solid #333; overflow-x: auto; }
.tab { padding: 6px 12px; background: #2d2d30; color: #969696; border: none; cursor: pointer; font-size: 13px; border-top-left-radius: 4px; border-top-right-radius: 4px; white-space: nowrap; display: flex; align-items: center; gap: 6px; }
.tab:hover { background: #1e1e1e; color: #ccc; }
.tab.active { background: #1e1e1e; color: #fff; border-bottom: 2px solid #007acc; }
.tab i { font-size: 11px; }
.tab.server { border-bottom-color: #25d366; }

#workspace { flex: 1; display: flex; flex-direction: row; overflow: hidden; min-height:0; }
#workspace[data-view="editor"] #editor,
#workspace[data-view="preview"] #preview,
#workspace[data-view="server"] #serverPreview,
#workspace[data-view="split"] #editor,
#workspace[data-view="split"] #preview { min-height:0; }

#workspace[data-view="editor"] #editor { flex: 1; }
#workspace[data-view="editor"] #preview,
#workspace[data-view="editor"] #serverPreview { display: none; }

#workspace[data-view="preview"] #preview { flex: 1; }
#workspace[data-view="preview"] #editor,
#workspace[data-view="preview"] #serverPreview { display: none; }

#workspace[data-view="server"] #serverPreview { flex: 1; }
#workspace[data-view="server"] #editor,
#workspace[data-view="server"] #preview { display: none; }

#workspace[data-view="split"] #editor,
#workspace[data-view="split"] #preview { flex: 1; display: block; }
#workspace[data-view="split"] #serverPreview { display: none; }

#workspace[data-view="split"] { flex-direction: row; }
@media (max-width:768px){
  #workspace[data-view="split"] { flex-direction: column; }
}

#editor { min-height: 0; }
#preview, #serverPreview { border: none; width: 100%; height: 100%; background: #fff; }

#modalLoadHTML { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 9999; }
#modalLoadHTML .modal-content { background: #1e1e1e; padding:16px; border-radius:8px; width:90%; max-width:700px; display:flex; flex-direction:column; gap:8px;color:white; }
#modalLoadHTML textarea { width:100%; height:150px; background:#111; color:#fff; border:1px solid #444; border-radius:4px; font-family:monospace; padding:8px; resize:vertical; }
#modalLoadHTML .modal-buttons { display:flex; justify-content:flex-end; gap:8px; }
#modalLoadHTML button { padding:6px 12px; border-radius:4px; border:none; cursor:pointer; background:#007acc; color:#fff; }
#modalLoadHTML button:hover { background:#005a99; }
</style>
</head>
<body>
<div id="root"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.0/umd/react.development.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.0/umd/react-dom.development.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.54.0-dev-20250930/min/vs/loader.js"></script>
<script>
const { useState, useEffect, useRef } = React;

const FILES = {
  'index.html': {
    language: 'html',
    icon: 'fa-brands fa-html5',
    content: `<!DOCTYPE html>
<html lang="es">
  
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>WhatsChat | MensajerÃ­a Simple y RÃ¡pida ðŸ’¬</title>
  
  <meta name="description" content="WhatsChat: Chatea con tus amigos y familiares con una interfaz familiar y fÃ¡cil de usar. Â¡ConÃ©ctate de forma instantÃ¡nea y segura!">
  <meta name="keywords" content="WhatsChat, Chat, MensajerÃ­a, Social, ComunicaciÃ³n, Amigos, Mensajes, WhatsApp Style">
  <meta name="author" content="AgustÃ­n DÃ­az">
  <meta name="robots" content="index, follow">
  
  <link rel="canonical" href="https://whatschat-ix08.onrender.com/"> 
  
  <link rel="icon" href="https://i.imgur.com/F9CqhP3.jpeg"> 
  
  <meta property="og:title" content="WhatsChat: La MensajerÃ­a que Conoces">
  <meta property="og:description" content="Una aplicaciÃ³n de chat rÃ¡pida y privada con el diseÃ±o que ya amas. EnvÃ­a mensajes, fotos y audios al instante.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://i.imgur.com/F9CqhP3.jpeg"> 
  <meta property="og:url" content="https://whatschat-ix08.onrender.com/"> <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="WhatsChat: Chatea Ya Mismo ðŸ‘‹">
  <meta name="twitter:description" content="ComunÃ­cate sin complicaciones. Disfruta de una experiencia de chat intuitiva y enfocada en lo que importa: tus conversaciones.">
  <meta name="twitter:image" content="https://tuti-html.netlify.app/imagen/html.png"> 
  <style>
* {
  box-sizing: border-box;
}

/* ===== Body ===== */
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
    Roboto, Arial, sans-serif;
  height: 100dvh; /* FIX mobile */
}

/* ===== App container ===== */
.app {
  width: 100%;
  height: 100dvh; /* FIX mobile */
  background: #efeae2;
  display: flex;
  flex-direction: column;
}

/* ===== Desktop ===== */
@media (min-width: 768px) {
  .app {
    height: 100vh;
  }
}

/* ===== Header ===== */
.header {
  height: 56px;
  background: #ffffff;
  color: #000;
  display: flex;
  align-items: center;
  padding: 0 16px;
  font-weight: 600;
  font-size: 16px;
  flex-shrink: 0;
}

/* ===== Messages ===== */
.messages {
  flex: 1;
  padding: 12px 10px;
  padding-bottom: calc(70px + env(safe-area-inset-bottom)); /* FIX */
  overflow-y: auto;
  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><rect width="100" height="100" fill="%23efeae2"/></svg>');
}

/* ===== Message bubbles ===== */
.message {
  max-width: 78%;
  margin-bottom: 8px;
  padding: 6px 8px 18px;
  font-size: 14px;
  line-height: 1.35;
  border-radius: 7.5px;
  position: relative;
  word-wrap: break-word;
  box-shadow: 0 1px 0.5px rgba(0, 0, 0, 0.13);
}

.message.me {
  background: #dcf8c6;
  margin-left: auto;
  border-bottom-right-radius: 0;
}

.message.other {
  background: #ffffff;
  margin-right: auto;
  border-bottom-left-radius: 0;
}

/* ===== Time ===== */
.time {
  position: absolute;
  right: 6px;
  bottom: 3px;
  font-size: 11px;
  color: #667781;
  white-space: nowrap;
}

/* ===== Input bar ===== */
.input-bar {
  position: relative;
  display: flex;
  align-items: center;
  padding: 8px;
  padding-bottom: calc(8px + env(safe-area-inset-bottom)); /* FIX */
  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><rect width="100" height="100" fill="%23efeae2"/></svg>');
  flex-shrink: 0;
}

/* ===== Input ===== */
.input-bar input {
  flex: 1;
  height: 40px;
  border: none;
  border-radius: 20px;
  padding: 0 48px 0 14px;
  font-size: 15px;
  outline: none;
  background: #ffffff;
}

/* ===== Send button ===== */
#send {
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  width: 33px;
  height: 33px;
  border-radius: 50%;
  border: none;
  background: green; /* WhatsApp green */
  display: flex;
  align-items: center;
  justify-content: center;
}

#send svg {
  width: 19px;
  height: 19px;
  fill: white;
}
  </style>
</head>
<body>
  <div class="app">
    <div class="header">WhatsChat</div>

    <div id="mensajes" class="messages"></div>

    <div class="input-bar">
      <input id="input" type="text" placeholder="EscribÃ­ un mensajeâ€¦" autocomplete="off" />
      <button id="send">
              <svg viewBox="0 0 20 24">
        <path d="M2 21l21-9L2 3v7l15 2-15 2v7z" />
      </svg>
      </button>
    </div>
  </div>

  <!-- Socket.IO (NO MODIFICAR BACKEND) -->
  <script src="/socket.io/socket.io.js"><\/script>
  <script>
    const socket = io();

    const mensajes = document.getElementById("mensajes");
    const input = document.getElementById("input");
    const btn = document.getElementById("send");

    socket.on("message", data => {
      render(data.text, data.me, data.time);
    });

    btn.onclick = send;
    input.addEventListener("keydown", e => {
      if (e.key === "Enter") send();
    });

    function send() {
      const text = input.value.trim();
      if (!text) return;

      socket.emit("message", { text });
      input.value = "";
    }

    function render(text, me, time) {
  const div = document.createElement("div");
  div.className = "message " + (me ? "me" : "other");
  
  const msg = document.createElement("div");
  msg.textContent = text;
  
  const t = document.createElement("div");
  t.className = "time";
  
  const date = time ? new Date(Number(time)) : new Date();
  
  t.textContent = date.toLocaleTimeString("es-AR", {
    hour: "2-digit",
    minute: "2-digit"
  });
  
  div.appendChild(msg);
  div.appendChild(t);
  mensajes.appendChild(div);
  mensajes.scrollTop = mensajes.scrollHeight;
}
  <\/script>
</body>
</html>`
  },
  'app.js': {
    language: 'javascript',
    icon: 'fa-brands fa-node-js',
    content: `const express = require("express");
const path = require("path");
const http = require("http");
const { Server } = require("socket.io");
const { Pool } = require("pg");

const app = express();
const server = http.createServer(app);
const io = new Server(server);

const PORT = process.env.PORT || 3000;

// ===== PostgreSQL =====
const pool = new Pool({
connectionString: process.env.DATABASE_URL,
ssl: process.env.NODE_ENV === "production" ?
{ rejectUnauthorized: false } :
false
});

(async () => {
await pool.query(\`
CREATE TABLE IF NOT EXISTS messages (
id SERIAL PRIMARY KEY,
text TEXT NOT NULL,
timestamp BIGINT NOT NULL
)
\`);
console.log("ðŸŸ¢ Tabla messages lista");
})();

// ===== Express =====
app.use(express.static(__dirname));

app.get("/", (_, res) => {
res.sendFile(path.join(__dirname, "index.html"));
});

// ===== Socket.IO =====
io.on("connection", async socket => {
console.log("ðŸ”— Usuario conectado:", socket.id);

// Enviar historial
const { rows } = await pool.query(
"SELECT text, timestamp FROM messages ORDER BY id ASC LIMIT 100"
);

rows.forEach(row => {
socket.emit("message", {
text: row.text,
time: row.timestamp,
me: false
});
});

socket.on("message", async data => {
const time = Date.now();

await pool.query(
"INSERT INTO messages (text, timestamp) VALUES ($1, $2)",
[data.text, time]
);

io.sockets.sockets.forEach(s => {
s.emit("message", {
text: data.text,
time,
me: s.id === socket.id
});
});
});

socket.on("disconnect", () => {
console.log("âŒ Usuario desconectado:", socket.id);
});
});

server.listen(PORT, "0.0.0.0", () => {
console.log("ðŸš€ Servidor escuchando en puerto", PORT);
});`
  },
  'package.json': {
    language: 'json',
    icon: 'fa-solid fa-box',
    content: `{
  "name": "whatschat",
  "version": "1.0.0",
  "description": "Chat en tiempo real estilo WhatsApp con Socket.IO y SQLite",
  "main": "app.js",
  "license": "MIT",
  "scripts": {
    "start": "node app.js"
  },
  "engines": {
    "node": ">=20"
  },
  "dependencies": {
    "express": "4.19.2",
    "socket.io": "4.8.1",
    "pg": "8.11.5"
  }
}`
  }
};

const SERVER_URL = 'https://whatschat-ix08.onrender.com';

function App() {
  const [view, setView] = useState('split');
  const [activeFile, setActiveFile] = useState('index.html');
  const [files, setFiles] = useState(FILES);
  const [modalOpen, setModalOpen] = useState(false);
  const [textareaValue, setTextareaValue] = useState('');
  const editorRef = useRef(null);
  const iframeRef = useRef(null);
  const serverIframeRef = useRef(null);

  const renderPreview = (html) => {
    if (iframeRef.current) iframeRef.current.srcdoc = html;
  };

  useEffect(() => {
    require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.54.0-dev-20250930/min/vs' } });
    require(['vs/editor/editor.main'], () => {
      editorRef.current = monaco.editor.create(document.getElementById('editor'), {
        value: FILES['index.html'].content,
        language: FILES['index.html'].language,
        theme: 'vs-dark',
        wordWrap: 'on',
        minimap: { enabled: true },
        automaticLayout: true
      });
      renderPreview(FILES['index.html'].content);
      
      const debounce = (fn, delay=300) => { 
        let t; 
        return (...args)=>{ 
          clearTimeout(t); 
          t=setTimeout(()=>fn(...args), delay); 
        }; 
      };
      
      editorRef.current.onDidChangeModelContent(debounce(()=> {
        const newContent = editorRef.current.getValue();
        setFiles(prev => ({
          ...prev,
          [activeFile]: { ...prev[activeFile], content: newContent }
        }));
        if (activeFile === 'index.html') {
          renderPreview(newContent);
        }
      }, 250));
    });
  }, []);

  const switchFile = (filename) => {
    if (editorRef.current && filename !== activeFile) {
      const file = files[filename];
      const model = monaco.editor.createModel(file.content, file.language);
      editorRef.current.setModel(model);
      setActiveFile(filename);
      
      if (filename === 'index.html') {
        renderPreview(file.content);
      }
    }
  };

  const openModal = () => {
    setTextareaValue(files[activeFile].content);
    setModalOpen(true);
  };

  const loadHTML = () => {
    setFiles(prev => ({
      ...prev,
      [activeFile]: { ...prev[activeFile], content: textareaValue }
    }));
    if (editorRef.current) {
      editorRef.current.setValue(textareaValue);
    }
    if (activeFile === 'index.html') {
      renderPreview(textareaValue);
    }
    setView('split');
    setModalOpen(false);
  };

  const switchView = (newView) => {
    setView(newView);
    setTimeout(() => editorRef.current?.layout(), 50);
  };

  return (
    React.createElement('div', {id:'app'},
      React.createElement('div', {id:'toolbar'},
        React.createElement('h1', null, 'Vs-Kode'),
        React.createElement('div', {className:'toolbar-actions'},
          React.createElement('button', {onClick:()=>switchView('split')}, React.createElement('i',{className:'fa-solid fa-columns'}), ' Split'),
          React.createElement('button', {onClick:()=>switchView('editor')}, React.createElement('i',{className:'fa-solid fa-code'}), ' Editor'),
          React.createElement('button', {onClick:()=>switchView('preview')}, React.createElement('i',{className:'fa-solid fa-eye'}), ' Preview'),
          React.createElement('button', {onClick:()=>switchView('server'), style:{background:'#25d366'}}, React.createElement('i',{className:'fa-solid fa-server'}), ' Server'),
          React.createElement('button', {onClick:openModal}, React.createElement('i',{className:'fa-solid fa-file-import'}), ' Cargar')
        )
      ),
      React.createElement('div', {id:'tabs'},
        Object.keys(files).map(filename =>
          React.createElement('button', {
            key: filename,
            className: 'tab' + (activeFile === filename ? ' active' : ''),
            onClick: () => switchFile(filename)
          },
            React.createElement('i', {className: files[filename].icon}),
            filename
          )
        )
      ),
      React.createElement('div', {id:'workspace', 'data-view':view},
        React.createElement('div', {id:'editor'}),
        React.createElement('iframe', {id:'preview', ref:iframeRef}),
        React.createElement('iframe', {id:'serverPreview', ref:serverIframeRef, src:SERVER_URL})
      ),
      modalOpen && React.createElement('div', {id:'modalLoadHTML', style:{display:'flex'}},
        React.createElement('div', {className:'modal-content'},
          React.createElement('h2', null, 'Editar ' + activeFile),
          React.createElement('textarea', {value:textareaValue, onChange:e=>setTextareaValue(e.target.value)}),
          React.createElement('div', {className:'modal-buttons'},
            React.createElement('button', {onClick:()=>setModalOpen(false)}, 'Cancelar'),
            React.createElement('button', {onClick:loadHTML}, 'Guardar')
          )
        )
      )
    )
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(React.createElement(App));
</script>
</body>
</html>